#!/bin/bash

unameOut="$(uname -s)"
case "${unameOut}" in
  Linux*)     platform=linux;;
  Darwin*)    platform=mac;;
  CYGWIN*)    platform=cygwin;;
  MINGW*)     platform=mingw;;
  *)          platform="UNKNOWN:${unameOut}"
esac

if [ "$platform" == "mac" ]; then
  echo "Detected MacOS"
  if ! command -v brew &> /dev/null; then
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    eval "$(/opt/homebrew/bin/brew shellenv)"
  fi
  brew install \
    age \
    ffmpeg \
    fzf \
    gh \
    node \
    nomad \
    pnpm \
    ripgrep \
    rustup \
    vim \
    utm \
    wezterm \
    wget \
    zoxide \
    ;
  if command -v rustup &> /dev/null; then
    rustup component add rust-src rust-analyzer
  fi
  if ! command -v dotter &> /dev/null; then
    cargo install dotter
  fi
elif [ "$platform" == "linux" ]; then
  echo "Linux Detected"
  if [ -f "/etc/arch-release" ]; then
    echo "ArchLinux detected"
    if ! command -v paru &> /dev/null; then
      if command -v yay &> /dev/null; then
        yay -Sy --noconfirm paru-bin
      fi
    fi
    if ! command -v paru &> /dev/null; then
      echo "Please install paru"
      exit 1
    fi
    paru -Sy --noconfirm \
      age \
      bspwm \
      dotter-rs-bin \
      git \
      google-chrome \
      gvim \
      linux-headers \
      lua \
      picom \
      polybar \
      rofi \
      sxhkd \
      unzip \
      wezterm \
      xsel
  else
    echo "Unsupported Linux Distro"
    exit 1
  fi
fi
